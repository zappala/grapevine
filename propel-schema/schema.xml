<?xml version="1.0" encoding="UTF-8"?>
<database name="grapevine" defaultIdMethod="native">

	<table name="conclusion" phpName="Conclusion">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<!-- 
		one-to-many:
			source
			note
		extended by:
			person
			relationship
			event rote
			event
			fact
			name
		-->
	</table>

	<table name="note" phpName="Note">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="text" type="text" required="true" />
		<column name="conclusion_id" type="integer" required="false" />
		<column name="source_id" type="integer" required="false" />
		<foreign-key foreignTable="conclusion" onDelete="cascade">
			<reference local="conclusion_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="source" onDelete="cascade">
			<reference local="source_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="source" phpName="Source">
		<column name="id" type="integer" required="true" primaryKey="true" />
		<column name="conclustion_id" type="integer" required="true" />
		<column name="title" type="varchar" size="255" required="true" />
		<column name="citation" type="varchar" size="255" required="true" />
		<!-- one-to-many -->
		<foreign-key foreignTable="conclusion" onDelete="cascade">
			<reference local="conclusion_id" foreign="id" />
		</foreign-key>
		<!-- one-to-one -->
		<foreign-key foreignTable="attribution" onDelete="cascade">
			<reference local="attribution_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="attribution" phpName="Attribution">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="agent_id" type="integer" required="true" />
		<column name="contributor_id" type="integer" required="true" />
		<column name="modified" type="timestamp" required="true" />
		<column name="changeMessage" type="varchar" size="255" required="true" />
		<!-- one-to-many -->
		<foreign-key foreignTable="agent" onDelete="cascade">
			<reference local="agent_id" foreign="id" />
		</foreign-key>

	</table>

	<table name="agent" phpName="Agent">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="name" type="varchar" size="255" required="true" />
		<column name="email" type="varchar" size="255" required="true" />
		<column name="phone" type="varchar" size="20" required="true" />
		<column name="address" type="text" required="true" />
		<!--
		many-to-one:
			attribution
		-->
	</table>

	<table name="person" phpName="Person">
		<behavior name="concrete_inheritance">
			<parameter name="extends" value="conclusion">
		</behavior>
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="living" type="boolean" required="false" />
		<column name="gender" type="enum" valueSet="Male, Female, Unknown" required="false" />
		<!--
		one-to-many 
			identifier
			name
			fact
			attribution
		-->
	</table>

</database>
