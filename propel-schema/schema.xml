<?xml version="1.0" encoding="UTF-8"?>
<database name="grapevine" defaultIdMethod="native">

	<table name="conclusion" phpName="Conclusion">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<!-- 
		one-to-many:
			source
			note
		extended by:
			person
			relationship
			event rote
			event
			fact
			name
		-->
	</table>

	<table name="note" phpName="Note">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="text" type="text" required="true" />
		<column name="conclusion_id" type="integer" required="false" />
		<column name="source_id" type="integer" required="false" />
		<foreign-key foreignTable="conclusion" onDelete="cascade">
			<reference local="conclusion_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="source" onDelete="cascade">
			<reference local="source_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="source" phpName="Source">
		<column name="attribution_id" type="integer" required="true" primaryKey="true" />
		<column name="conclusion_id" type="integer" required="true" />
		<column name="title" type="varchar" size="255" required="true" />
		<column name="citation" type="varchar" size="255" required="true" />
		<!-- one-to-many -->
		<foreign-key foreignTable="conclusion" onDelete="cascade">
			<reference local="conclusion_id" foreign="id" />
		</foreign-key>
		<!-- one-to-one -->
		<foreign-key foreignTable="attribution" onDelete="cascade">
			<reference local="attribution_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="attribution" phpName="Attribution">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="agent_id" type="integer" required="true" />
		<column name="contributor_id" type="integer" required="true" />
		<column name="modified" type="timestamp" required="true" />
		<column name="changeMessage" type="varchar" size="255" required="true" />
		<!-- one-to-many -->
		<foreign-key foreignTable="agent" onDelete="cascade">
			<reference local="agent_id" foreign="id" />
		</foreign-key>
		<!-- one-to-one:
			source
			event
			relationship
			person
		-->
	</table>

	<table name="agent" phpName="Agent">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="name" type="varchar" size="255" required="true" />
		<column name="email" type="varchar" size="255" required="true" />
		<column name="phone" type="varchar" size="20" required="true" />
		<column name="address" type="text" required="true" />
		<!--
		many-to-one:
			attribution
		-->
	</table>

	<table name="person" phpName="Person">
		<behavior name="concrete_inheritance">
			<parameter name="extends" value="conclusion">
		</behavior>
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="living" type="boolean" required="false" />
		<column name="gender" type="enum" valueSet="Male, Female, Unknown" required="false" />
		<!--
		one-to-many: 
			identifier
			name
			fact
			attribution
		-->
	</table>

	<table name="relationship" phpName="Relationship">
		<column name="attribution_id" type="integer" required="true" primaryKey="true" />
		<column name="type" type="enum" valueSet="Couple, ParentChild" required="true" />
		<column name="person1_id" type="integer" required="true" />
		<column name="person2_id" type="integer" required="true" />
		<foreign-key foreignTable="attribution" onDelete="cascade">
			<reference local="attribution_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="event" phpName="Event">
		<column name="attribution_id" type="integer" required="true" primaryKey="true" />
		<column name="date" type="timestamp" required="false" />
		<column name="place" type="text" required="false" />
		<column name="type" type="enum" 
			valueSet="	Adoption, 
						AdultChristening,
						Annulment,
						Baptism,
						BarMitzvah,
						BatMitzvah,
						Birth,
						Blessing,
						Burial,
						Census,
						Christening,
						Cicumcision,
						Confirmation,
						Cremation,
						Death,
						Divorce,
						Education,
						Engagement,
						Emigration,
						Excommunication,
						FirstCommunion,
						Funeral,
						Immigration,
						LandTransaction,
						Marriage,
						MilitaryAward,
						MilitaryDischarge,
						Mission,
						MoveFrom,
						MoveTo,
						Naturalization,
						Ordination,
						Retirement" 
			required="true" />
		<foreign-key foreignTable="attribution" onDelete="cascade">
			<reference local="attribution_id" foreign="id" />
		</foreign-key>
		<!--
		one-to-many:
			roles
		-->
	</table>

	<table name="role" phpName="Role">
		<column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="event_id" type="integer" required="true" />
		<column name="person_id" type="integer" required="true" />
		<column name="details" type="text" required="false" />
		<column name="type" type="enum" valueSet="Principal, Participant, Official, Witness" required="true" />
		<!-- one-to-many -->
		<foreign-key foreignTable="event" onDelete="cascade">
			<reference local="event_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="person" onDelete="cascade">
			<reference local="person_id" foreign="id" />
		</foreign-key>
		
	</table>
</database>
